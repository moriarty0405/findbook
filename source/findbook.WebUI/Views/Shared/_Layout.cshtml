<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html  xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
    <title>@ViewBag.Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <link href="../../Content/bootstrap-responsive.css" rel="stylesheet" type="text/css" />
    @*<link href="../../Content/bootstrap.min.css" rel="stylesheet" type="text/css" />*@
    <link href="../../Content/style.css" rel="stylesheet" type="text/css" />

    <link href="../../Content/Site.css" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery-1.6.3.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.featureCarousel.js")" type="text/javascript"></script>   
    <script src="@Url.Content("~/Scripts/bootstrap.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-1.9.1.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/bootstrap-tab.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/bootstrap-typeahead.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.form.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/script.js")" type="text/javascript"></script>
    @*<script src="@Url.Content("~/Scripts/script.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-1.5.1.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery.unobtrusive-ajax.js")" type="text/javascript"></script>*@
    
    @{
        bool authenticated = Context.User.Identity.IsAuthenticated;
        
        string userID = "";

        if (authenticated) {
            //从cookie中获取userID
            HttpCookie cookie = Request.Cookies["user"];

            userID = cookie["userID"].ToString();
            
            //将信息写入session中
            Session["logOnUserID"] = userID;
        }
                                    
    }

@*使用Comet轮询，显示未读消息数*@
@*使用有问题，网页速度减慢很多*@
@*<script type="text/javascript">
    $(function () {
        function long_polling() {
            $.getJSON('/SysMesComet/LongPolling', function (data) {
                //如果收到的消息数不为0
                if (data.mesNum) {
                    //将消息数显示到消息文字上
                    $('top_nav').append('<div class=message_inform"><label>' + data.mesNum
                                + "</label></div>");
                }
                long_polling();
            });
        }
        long_polling();
    });
</script>*@

</head>
<body>
    <div class="top_div">
	    <a name="return_top"></a>
	    <div class="top_header">
		    <!--==============================logo================================-->
		    @*<a href="Home/Index" class="top_logo_img"></a>*@
            @Html.RouteLink(" ", new {
                   Controller = "Home",
                   Action = "Index"
               }, new { @class = "top_logo_img" })
		    <!--==============================nav================================-->
		    <div class="top_nav">
                @*<a href="Home/Index" class="selected">翻书</a>*@
                @Html.RouteLink("首页", new {
                    Controller = "Home",
                    Action = "Index"
                   }, new { @class = "selected", @id="index" })

			    @*<a href="Home/Free" class="free">免费</a>*@
                @Html.RouteLink("免费", new {
                    Controller = "Home",
                    Action = "Free"
                   }, new { @id = "free" })

			    @*<a href="#" class="">推荐</a>*@
                @Html.RouteLink("推荐", new {
                    Controller = "Home",
                    Action = "Recommend"
                   }, new { @id = "recommed" })

			    <a href="#" class="">发现</a>
			    @*<a href="#" class="">消息</a>*@
                @{
                    if (authenticated) {
                        @*<a href="#">私信</a>*@
                        @Html.RouteLink("消息", new {
                           Controller = "SysMessage",
                           Action = "UnRead",
                           userID = userID
                        }, new { @id = "sysMes"})
                    }
                 }
                
		    </div>
		    <!--=============================search=================================-->
		    <div class="search">
			    @*<form method="post" class="searchform" action="">*@
                @using (Html.BeginForm("Show", "Search", FormMethod.Post, new { @class = "searchform" })) {
				    <input type="text" name="kw" id="kw" placeholder="搜索..." class="search_txt" />
				    <input type="submit" class="search_btn" value="" />
                }

                @if (authenticated) {
                    string imgPath = "../../Content/Images/users/" + userID + ".jpg";
                    <span class="user_login">
				        <a href="#" target="_blank" ><img src=@imgPath width="25px" height="25px" border="0"/><span style="padding-bottom:10px;">@Context.User.Identity.Name</span></a>
				        <ul class="user_login_ul">
					        <li>
                                @Html.RouteLink("我的主页", new {
                               Controller = "Page",
                               Action = "List",
                               userID = userID
                           })
                            </li>
					        <li>
                                @*<a href="#">私信</a>*@
                                @Html.RouteLink("私信", new {
                               Controller = "Private",
                               Action = "List",
                               userID = userID
                           })
                            </li>
					        @*<li><a href="#">消息</a></li>*@
					        @*<li><a href="#">用户中心</a></li>*@
                            <li>
                                @*<a href="#">私信</a>*@
                                @Html.RouteLink("用户中心", new {
                               Controller = "Info",
                               Action = "Profile",
                               userID = userID
                           })
                            </li>
                            <li>
                                <a href="">购买信息</a>
                            </li>

					        <li>@Html.ActionLink("退出", "LogOff", "Account")</li>
				        </ul>
			        </span>
                } else {
                    <a href="../Account/LogOn">登录</a><p class="pipe">|</p><a href="../Account/Register">注册</a>
                }
			    
		    </div>
	    </div>
    </div>
    
    <div>
        @RenderBody()        
    </div>

    <div class="footer">
	    <div class="footer_content">
		    <span style=" font-family:'微软雅黑'; font-size:36px; color:#999;">翻书网</span>&nbsp;
		    <span style=" font-family:'微软雅黑'; font-size:16px; color:#999; letter-spacing:1px;">属于whut的课本馆,在这里找到你最期盼的那一本书</span>
		    <table>
			    <tbody>
				    <tr><td><a href="#">关于我们</a>|</td><td><a href="#">常见问题</a>|</td><td><a href="#">免责声明</a>|</td><td><a href="#">友情链接</a>|</td><td><a href="#">联系我们</a>|</td><td><a href="#">微博</a></td></tr>
			    </tbody>
		    </table>
	    </div>
    </div>

    
</body>
</html>
